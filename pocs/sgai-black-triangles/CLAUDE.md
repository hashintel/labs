# CLAUDE.md

## Style

Be extremely concise. Sacrifice grammar for the sake of concision.

## Commands

```bash
pnpm install        # Install dependencies
pnpm dev            # Start dev server on port 3000
pnpm build          # Build for production
pnpm serve          # Preview production build
pnpm test           # Run tests with Vitest
pnpm lint           # Run ESLint
pnpm format         # Run Prettier
pnpm check          # Format and lint with auto-fix
```

## Architecture

This is a TanStack Start application (full-stack React meta-framework) with Claude AI integration.

### Tech Stack
- **Framework**: TanStack Start (built on Vite + Nitro)
- **Routing**: TanStack Router (file-based routing in `src/routes/`)
- **State**: TanStack Store + TanStack Query
- **Styling**: Tailwind CSS v4
- **AI**: Vercel AI SDK (`ai` package) + Anthropic Claude
- **MCP**: Model Context Protocol server support via `@modelcontextprotocol/sdk`

### Key Patterns

**File-based routing**: Routes are defined in `src/routes/`. The route tree is auto-generated in `src/routeTree.gen.ts` - do not edit this file manually.

**API routes**: Server handlers use the pattern `src/routes/demo/api.*.ts` with `server.handlers` export:
```typescript
export const Route = createFileRoute('/demo/api/example')({
  server: {
    handlers: {
      POST: async ({ request }) => { /* ... */ }
    }
  }
})
```

**AI chat integration**: Uses `@ai-sdk/react` `useChat` hook with `DefaultChatTransport` pointing to API routes. Server uses `streamText` from `ai` package with Anthropic models.

**MCP server**: The `/mcp` route exposes an MCP server using in-memory transports. Tools are registered via `server.registerTool()` with Zod schemas for input validation.

**Path aliases**: `@/*` maps to `./src/*` (configured in tsconfig.json).

### Project Structure
- `src/routes/__root.tsx` - Root layout with Header and DevTools
- `src/router.tsx` - Router setup with TanStack Query integration
- `src/integrations/tanstack-query/` - Query client provider
- `src/utils/` - Shared utilities (tools, MCP handler)
- `src/components/` - React components
- `src/data/` - Static data (guitars, songs examples)

## Environment Variables

Required in `.env.local`:
```
ANTHROPIC_API_KEY=your_api_key
```
